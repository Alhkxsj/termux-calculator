
import tkinter as tk
import math
import threading
import time

ä¸»é¢˜ = {
    "èƒŒæ™¯": "#121212",
    "å‰æ™¯": "#e0e0e0",
    "é«˜äº®": "#ff4081",
    "æŒ‰é’®èƒŒæ™¯": "#222222",
    "æŒ‰é’®å‰æ™¯": "#e0e0e0",
}

ä¿¡æ¯ = [
    "è¿™ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„æ•°å­—ã€‚",
    "å®ƒèƒŒåè—ç€æ¸©æš–å’Œç¥ç¦ã€‚",
    "æ„¿ä½ ä¸€ç›´å¹¸ç¦å¿«ä¹ã€‚",
]

def æ’­æ”¾åŠ¨ç”»(çª—å£, æ–‡æœ¬):
    æ–‡æœ¬æ¡† = tk.Text(çª—å£, bg=ä¸»é¢˜["èƒŒæ™¯"], fg=ä¸»é¢˜["é«˜äº®"], font=("Consolas", 14), bd=0)
    æ–‡æœ¬æ¡†.pack(expand=True, fill="both", padx=10, pady=10)
    def å†™å…¥():
        for ch in æ–‡æœ¬:
            æ–‡æœ¬æ¡†.insert("end", ch)
            æ–‡æœ¬æ¡†.update()
            time.sleep(0.05)
        æ–‡æœ¬æ¡†.config(state="disabled")
    threading.Thread(target=å†™å…¥).start()

def æ˜¾ç¤ºå½©è›‹():
    æ–°çª—å£ = tk.Toplevel()
    æ–°çª—å£.title("éšè—å½©è›‹")
    æ–°çª—å£.geometry("400x250")
    æ–°çª—å£.configure(bg=ä¸»é¢˜["èƒŒæ™¯"])
    æ–‡æœ¬ = "\n".join(["ğŸ’– å½©è›‹ ğŸ’–\n"] + ä¿¡æ¯ + ["\næ¥è‡ªä¸€ä¸ªç”¨å¿ƒçš„ç¨‹åº"])
    æ’­æ”¾åŠ¨ç”»(æ–°çª—å£, æ–‡æœ¬)

def è®¡ç®—(è¡¨è¾¾å¼, æ˜¾ç¤ºåŒºåŸŸ, è¾“å…¥æ¡†):
    try:
        if è¡¨è¾¾å¼.strip() == "520":
            æ˜¾ç¤ºå½©è›‹()
            return
        ç»“æœ = eval(è¡¨è¾¾å¼, {"__builtins__": None}, {
            "sqrt": math.sqrt,
            "pow": pow,
            "abs": abs,
            "round": round
        })
        æ˜¾ç¤ºåŒºåŸŸ.config(text=f"ç»“æœï¼š{round(ç»“æœ,6)}")
        if ç»“æœ == 520:
            æ˜¾ç¤ºå½©è›‹()
    except Exception:
        æ˜¾ç¤ºåŒºåŸŸ.config(text="é”™è¯¯ï¼šè¡¨è¾¾å¼æ— æ•ˆ")
    è¾“å…¥æ¡†.delete(0, 'end')

def ç‚¹å‡»(å€¼, è¾“å…¥æ¡†, æ˜¾ç¤ºåŒºåŸŸ):
    if å€¼ == "æ¸…é™¤":
        è¾“å…¥æ¡†.delete(0, 'end')
        æ˜¾ç¤ºåŒºåŸŸ.config(text="")
    elif å€¼ == "=":
        è¡¨è¾¾å¼ = è¾“å…¥æ¡†.get()
        è®¡ç®—(è¡¨è¾¾å¼, æ˜¾ç¤ºåŒºåŸŸ, è¾“å…¥æ¡†)
    else:
        è¾“å…¥æ¡†.insert('end', å€¼)

def ä¸»å‡½æ•°():
    ä¸»çª—å£ = tk.Tk()
    ä¸»çª—å£.title("è®¡ç®—æœºï¼ˆå›¾å½¢ç‰ˆï¼‰")
    ä¸»çª—å£.geometry("420x520")
    ä¸»çª—å£.configure(bg=ä¸»é¢˜["èƒŒæ™¯"])

    æ ‡é¢˜ = tk.Label(ä¸»çª—å£, text="è®¡ç®—æœº", font=("Arial", 24), fg=ä¸»é¢˜["é«˜äº®"], bg=ä¸»é¢˜["èƒŒæ™¯"])
    æ ‡é¢˜.pack(pady=20)

    è¾“å…¥æ¡† = tk.Entry(ä¸»çª—å£, font=("Consolas", 20), bg="#fff", fg="#000", justify="right")
    è¾“å…¥æ¡†.pack(padx=20, pady=10, ipady=10)

    æŒ‰é’®ç»„ = [
        ['7', '8', '9', '/'],
        ['4', '5', '6', '*'],
        ['1', '2', '3', '-'],
        ['0', '.', 'æ¸…é™¤', '+'],
        ['(', ')', 'sqrt', '=']
    ]

    æ¡†æ¶ = tk.Frame(ä¸»çª—å£, bg=ä¸»é¢˜["èƒŒæ™¯"])
    æ¡†æ¶.pack(pady=10)

    for è¡Œ in æŒ‰é’®ç»„:
        è¡Œæ¡†æ¶ = tk.Frame(æ¡†æ¶, bg=ä¸»é¢˜["èƒŒæ™¯"])
        è¡Œæ¡†æ¶.pack(pady=3)
        for æŒ‰é’® in è¡Œ:
            btn = tk.Button(è¡Œæ¡†æ¶, text=æŒ‰é’®, width=5, height=2, font=("Arial", 16),
                            bg=ä¸»é¢˜["æŒ‰é’®èƒŒæ™¯"], fg=ä¸»é¢˜["æŒ‰é’®å‰æ™¯"],
                            command=lambda x=æŒ‰é’®: ç‚¹å‡»(x, è¾“å…¥æ¡†, ä¸»çª—å£.children['!label2']))
            btn.pack(side="left", padx=5)

    æ˜¾ç¤ºåŒºåŸŸ = tk.Label(ä¸»çª—å£, text="", font=("Arial", 18), fg=ä¸»é¢˜["å‰æ™¯"], bg=ä¸»é¢˜["èƒŒæ™¯"])
    æ˜¾ç¤ºåŒºåŸŸ.pack(pady=20)

    ä¸»çª—å£.mainloop()

if __name__ == "__main__":
    ä¸»å‡½æ•°()
