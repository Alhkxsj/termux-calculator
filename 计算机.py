import time
import os
import sys

# 彩色与符号定义（马卡龙+少女风）
粉 = "\033[95m"
嫩粉 = "\033[38;5;218m"
蓝 = "\033[94m"
青 = "\033[96m"
红 = "\033[91m"
亮白 = "\033[97m"
黄 = "\033[93m"
紫 = "\033[38;5;183m"
重置 = "\033[0m"
BOLD = "\033[1m"
爱心 = "❤"
花朵 = "✿"
星星 = "★"
蝴蝶结 = "🎀"
闪 = "✨"
兔 = "ฅ^•ﻌ•^ฅ"
猫 = "ฅ●'ω'●ฅ"

def 清屏():
    os.system("clear" if os.name == "posix" else "cls")

def 打印渐变(text, delay=0.04, color=嫩粉, end='\n'):
    # 渐变动效（少女配色）
    for char in text:
        sys.stdout.write(f"{color}{char}{重置}")
        sys.stdout.flush()
        time.sleep(delay)
    print(end=end)

def 爱心动画():
    # 多帧爱心动画
    hearts = [
        f"{红}     💖        💖        💖     ",
        f"{红}  💗    💗  {花朵}  💗    💗  ",
        f"{红}{BOLD}💓  {闪} 刘婧仪 {闪}  💓{重置}",
        f"{红}  💗    💗  {蝴蝶结}  💗    💗  ",
        f"{红}     💖        💖        💖    {重置}"
    ]
    for _ in range(2):
        清屏()
        for line in hearts:
            print(line)
        time.sleep(0.5)
        清屏()
        time.sleep(0.2)

def 彩蛋():
    清屏()
    爱心动画()
    打印渐变(f"{蓝}{BOLD}💘 致我最爱的女孩：刘婧仪 💘{重置}", 0.07, 蓝)
    print()
    打印渐变(f"{嫩粉}你是我心中的光，是我每一天的期待与欢喜。{重置}", 0.045)
    打印渐变(f"{紫}你笑的样子，是世界上最美的风景。{重置}", 0.045)
    打印渐变(f"{青}我希望未来的日子里，有你、有我、有我们。{重置}", 0.045)
    print()
    打印渐变(f"{黄}💌 爱你的 —— 啊泠好困想睡觉{重置}", 0.06, 黄)
    print()
    打印渐变(f"{亮白}（按下回车继续使用少女计算器吧喵~）{重置}", 0.03, 亮白)
    input("")
    清屏()

def 打印Logo():
    # 顶部少女Logo和欢迎语
    print(f"{嫩粉}{BOLD}╔{'═'*46}╗{重置}")
    print(f"{嫩粉}{BOLD}║{重置}{' '*46}{嫩粉}{BOLD}║{重置}")
    print(f"{嫩粉}{BOLD}║{重置}   {粉}{花朵}{星星}{BOLD} 少女计算器终端版 {蝴蝶结}{星星}{花朵}  {嫩粉}{BOLD}║{重置}")
    print(f"{嫩粉}{BOLD}║{重置} {' '*44}{嫩粉}{BOLD}║{重置}")
    print(f"{嫩粉}{BOLD}╚{'═'*46}╝{重置}")
    打印渐变(f"{蓝}作者：快手：啊泠好困想睡觉{重置}", 0.01, 蓝)
    打印渐变(f"{青}提示：输入 exit / quit 可退出，520 有彩蛋，q 返回菜单~{重置}\n", 0.01, 青)

def 打印菜单Logo():
    # 主菜单Logo
    print(f"{紫}{BOLD}╭{'─'*46}╮{重置}")
    print(f"{紫}{BOLD}│{重置}{' '*46}{紫}{BOLD}│{重置}")
    print(f"{紫}{BOLD}│{重置}  {粉}{花朵}{星星}{BOLD} 少女计算器启动菜单 {蝴蝶结}{星星}{花朵}  {紫}{BOLD}│{重置}")
    print(f"{紫}{BOLD}│{重置}{' '*46}{紫}{BOLD}│{重置}")
    print(f"{紫}{BOLD}╰{'─'*46}╯{重置}")

def 打印分割线():
    print(f"{粉}{BOLD}{'═'*48}{重置}")

def 打印欢迎界面():
    打印Logo()

def 终端计算器():
    清屏()
    打印欢迎界面()
    while True:
        表达式 = input(f"{粉}{BOLD}➤ 请输入算式（支持 + - * / 等）：{重置}")
        if 表达式.strip().lower() in ("exit", "quit"):
            打印渐变(f"{蓝}再见喵~ 记得想我和刘婧仪哦 {爱心}{猫}{重置}", delay=0.045, color=蓝)
            time.sleep(0.5)
            break
        elif 表达式.strip() == "520":
            彩蛋()
            打印欢迎界面()
        elif 表达式.strip().lower() == "q":
            return  # 返回主菜单
        elif not 表达式.strip():
            打印渐变(f"{黄}喵呜，啥也没输入哦~{重置}", 0.03, 黄)
        else:
            try:
                结果 = eval(表达式, {"__builtins__": {}})
                打印渐变(f"{青}{BOLD}= {结果}{重置}", 0.02, 青)
            except Exception:
                打印渐变(f"{红}出错了喵，请检查格式~{重置}", 0.02, 红)

def 检查更新():
    打印渐变(f"{青}少女正在联网检查更新中...请稍等喵~{重置}", 0.04, 青)
    time.sleep(1)
    # 直接调用 shell 脚本
    os.system("$HOME/python/启动计算机.sh")

def 卸载少女计算器():
    打印渐变(f"{红}正在依依不舍地卸载少女计算器...{重置}", 0.035, 红)
    os.system("rm -rf $HOME/python")
    os.system("sed -i '/少女计算器/d' $HOME/.bashrc")
    打印渐变(f"{粉}卸载完成了，请重启 Termux 喵！{重置}", 0.04, 粉)
    time.sleep(1.2)

def 主菜单():
    while True:
        清屏()
        打印菜单Logo()
        打印渐变(f"{蓝}作者：快手：啊泠好困想睡觉{重置}\n", 0.01, 蓝)
        print(f"{嫩粉}{BOLD} 1. {青}启动终端版 {蝴蝶结}{重置}")
        print(f"{嫩粉}{BOLD} 2. {紫}检查更新 {闪}{重置}")
        print(f"{嫩粉}{BOLD} 3. {红}卸载少女计算器 {花朵}{重置}")
        print(f"{嫩粉}{BOLD} 4. {亮白}退出 {兔}{重置}")
        打印分割线()
        选项 = input(f"{黄}{BOLD}请选一个编号吧喵~ ➤ {重置}")

        if 选项 == "1":
            终端计算器()
        elif 选项 == "2":
            检查更新()
        elif 选项 == "3":
            卸载少女计算器()
            break
        elif 选项 == "4":
            打印渐变(f"{紫}再见喵~ 祝你每天都可爱又幸福！{重置}", 0.03, 紫)
            time.sleep(0.7)
            break
        else:
            打印渐变(f"{黄}喵？输入无效，再试一次哟~{重置}", 0.025, 黄)
            time.sleep(0.8)

if __name__ == "__main__":
    主菜单()
